(()=>{document.addEventListener("DOMContentLoaded",b);function b(){y(),A(),L(),C(),v(),l()}const r=".js-goods-card",u=".js-product-count";function l(e=!1){const t=document.querySelectorAll(".js-count-cart"),c=d("cart");let o=0;c.forEach(n=>o+=n.price*n.count),t.forEach(n=>{const a=n.parentElement.querySelector(".js-cart-text");n.innerText=c.length??"0",n.classList.toggle("show",!!c.length),a.innerText=c.length?`${o} ₽`:"Корзина"})}function L(){document.querySelectorAll(".js-add-cart").forEach(t=>{t.addEventListener("click",()=>{const c=t.closest(r),o=c.getAttribute("data-id"),n=document.querySelectorAll(`${r}[data-id='${o}']`);p(c),n.forEach(a=>{a.querySelector(".js-product-label").classList.add("show"),a.querySelector(".js-add-cart").setAttribute("hidden","hidden")})})})}function p(e){const c=e.getAttributeNames().filter(s=>s.includes("data")),o=c.map(s=>s.replace("data-","")),n=e.querySelector(u).value,a={};e.setAttribute("data-count",n),o.forEach((s,i)=>{a[s]=e.getAttribute(c[i])}),E(a),l()}function v(){localStorage.cart&&JSON.parse(localStorage.cart).forEach(t=>{document.querySelectorAll(`${r}[data-id='${t.id}']`).forEach(o=>{var s;const n=o.querySelector(u),a=n.parentElement;o.setAttribute("data-count",t.count),n.value=t.count,a.classList.add("show"),(s=a.nextElementSibling)==null||s.setAttribute("hidden","hidden")})})}function E(e){const t=d("cart");if(t.length){const c=t.findIndex(o=>o.id===e.id);c>=0&&+e.count>0?t[c]=e:t.push(e)}else t.push(e);f("cart",t)}function d(e){const t=localStorage[e];return t?JSON.parse(t):[]}function f(e,t){localStorage[e]=JSON.stringify(t)}function A(){document.querySelectorAll(u).forEach(t=>{t.addEventListener("change",()=>{t.value%1>0&&(t.value=Math.floor(t.value)),t.value<0&&(t.value="1")})})}function y(){document.addEventListener("click",e=>{const t=e.target.classList;t.contains("js-card-btn-inc")?S(e.target):t.contains("js-card-btn-dec")&&S(e.target,!1)})}function S(e,t=!0){const o=e.closest(r).getAttribute("data-id");document.querySelectorAll(`${r}[data-id='${o}']`).forEach(a=>{var m;const s=a.querySelector(".goods-card-buy__label"),i=s.querySelector("input");let g=Number(i.value);if(!t&&g-1<1){const h=d("cart"),q=h.findIndex(x=>x.id===o);return s.classList.remove("show"),(m=s.nextElementSibling)==null||m.removeAttribute("hidden"),a.setAttribute("data-count","0"),h.splice(q,1),f("cart",h),l(),!1}i.value=t?(++g).toString():(--g).toString(),p(a)})}function C(){document.addEventListener("click",e=>{if(e.target.classList.contains("js-delete-item")){const c=e.target.closest(r),o=c.getAttribute("data-id"),n=d("cart"),a=n.findIndex(s=>s.id===o);n.splice(a,1),f("cart",n),c.remove()}})}})();
