(()=>{document.addEventListener("DOMContentLoaded",p);function p(){v(),E(),S(),b(),d()}function d(e=!1){const t=document.querySelectorAll(".js-count-cart"),o=u("cart");let c=0;o.forEach(n=>c+=n.price*n.count),t.forEach(n=>{const a=n.parentElement.querySelector(".js-cart-text");n.innerText=o.length??"0",n.classList.toggle("show",!!o.length),a.innerText=o.length?`${c} ₽`:"Корзина"})}function S(){document.querySelectorAll(".js-add-cart").forEach(t=>{t.addEventListener("click",()=>{const o=t.closest(".js-goods-card"),c=o.getAttribute("data-id"),n=document.querySelectorAll(`.js-goods-card[data-id='${c}']`);f(o),n.forEach(a=>{a.querySelector(".js-product-label").classList.add("show"),a.querySelector(".js-add-cart").setAttribute("hidden","hidden")})})})}function f(e){const o=e.getAttributeNames().filter(r=>r.includes("data")),c=o.map(r=>r.replace("data-","")),n=e.querySelector(".js-product-count").value,a={};e.setAttribute("data-count",n),c.forEach((r,s)=>{a[r]=e.getAttribute(o[s])}),m(a),d()}function b(){localStorage.cart&&JSON.parse(localStorage.cart).forEach(t=>{document.querySelectorAll(`.js-goods-card[data-id='${t.id}']`).forEach(c=>{const n=c.querySelector(".js-product-count"),a=n.parentElement;c.setAttribute("data-count",t.count),n.value=t.count,a.classList.add("show"),a.nextElementSibling.setAttribute("hidden","hidden")})})}function m(e){const t=u("cart");if(t.length){const o=t.findIndex(c=>c.id===e.id);o>=0&&+e.count>0?t[o]=e:t.push(e)}else t.push(e);g("cart",t)}function u(e){const t=localStorage[e];return t?JSON.parse(t):[]}function g(e,t){localStorage[e]=JSON.stringify(t)}function E(){document.querySelectorAll(".js-product-count").forEach(t=>{t.addEventListener("change",()=>{t.value%1>0&&(t.value=Math.floor(t.value)),t.value<0&&(t.value="1")})})}function v(){document.addEventListener("click",e=>{const t=e.target.classList;t.contains("js-card-btn-inc")?h(e.target):t.contains("js-card-btn-dec")&&h(e.target,!1)})}function h(e,t=!0){const c=e.closest(".js-goods-card").getAttribute("data-id");document.querySelectorAll(`.js-goods-card[data-id='${c}']`).forEach(a=>{const r=a.querySelector(".goods-card-buy__label"),s=r.querySelector("input");let i=Number(s.value);if(!t&&i-1<1){const l=u("cart"),y=l.findIndex(L=>L.id===c);return r.classList.remove("show"),r.nextElementSibling.removeAttribute("hidden"),a.setAttribute("data-count","0"),l.splice(y,1),g("cart",l),d(),!1}s.value=t?(++i).toString():(--i).toString(),f(a)})}})();
