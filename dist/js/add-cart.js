document.addEventListener("DOMContentLoaded",b);function b(){L(),y(),m(),E(),i()}function i(e=!1){const t=document.querySelectorAll(".js-count-cart"),o=l("cart");let c=0;o.forEach(n=>c+=n.price*n.count),t.forEach(n=>{const a=n.parentElement.querySelector(".js-cart-text");n.innerText=o.length??"0",n.classList.toggle("show",!!o.length),a.innerText=o.length?`${c} ₽`:"Корзина"})}function m(){document.querySelectorAll(".js-add-cart").forEach(t=>{t.addEventListener("click",()=>{const o=t.closest(".js-goods-card"),c=o.getAttribute("data-id"),n=document.querySelectorAll(`.js-goods-card[data-id='${c}']`);g(o),n.forEach(a=>{a.querySelector(".js-product-label").classList.add("show"),a.querySelector(".js-add-cart").setAttribute("hidden","hidden")})})})}function g(e){const o=e.getAttributeNames().filter(r=>r.includes("data")),c=o.map(r=>r.replace("data-","")),n=e.querySelector(".js-product-count").value,a={};e.setAttribute("data-count",n),c.forEach((r,s)=>{a[r]=e.getAttribute(o[s])}),v(a),i()}function E(){localStorage.cart&&JSON.parse(localStorage.cart).forEach(t=>{document.querySelectorAll(`.js-goods-card[data-id='${t.id}']`).forEach(c=>{const n=c.querySelector(".js-product-count"),a=n.parentElement;c.setAttribute("data-count",t.count),n.value=t.count,a.classList.add("show"),a.nextElementSibling.setAttribute("hidden","hidden")})})}function v(e){const t=l("cart");if(t.length){const o=t.findIndex(c=>c.id===e.id);o>=0&&+e.count>0?t[o]=e:t.push(e)}else t.push(e);h("cart",t)}function l(e){const t=localStorage[e];return t?JSON.parse(t):[]}function h(e,t){localStorage[e]=JSON.stringify(t)}function y(){document.querySelectorAll(".js-product-count").forEach(t=>{t.addEventListener("change",()=>{t.value%1>0&&(t.value=Math.floor(t.value)),t.value<0&&(t.value="1")})})}function L(){document.addEventListener("click",e=>{const t=e.target.classList;t.contains("js-card-btn-inc")?f(e.target):t.contains("js-card-btn-dec")&&f(e.target,!1)})}function f(e,t=!0){const c=e.closest(".js-goods-card").getAttribute("data-id");document.querySelectorAll(`.js-goods-card[data-id='${c}']`).forEach(a=>{const r=a.querySelector(".goods-card-buy__label"),s=r.querySelector("input");let d=Number(s.value);if(!t&&d-1<1){const u=l("cart"),p=u.findIndex(S=>S.id===c);return r.classList.remove("show"),r.nextElementSibling.removeAttribute("hidden"),a.setAttribute("data-count","0"),u.splice(p,1),h("cart",u),i(),!1}s.value=t?(++d).toString():(--d).toString(),g(a)})}
